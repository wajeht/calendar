const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModalPassword-Cdtp_CvD.js","assets/vendor-CQEko2iO.js","assets/Button-CzEj_lhU.js","assets/Button-A5E1YjHX.css","assets/Input-ZV2_aOD0.js","assets/fullcalendar-PBRWkKLf.js","assets/ModalSettings-Dguxsjt8.js","assets/ModalEvent-DPq7BoQc.js","assets/ModalConfirm-oeKXVKLM.js","assets/ModalSetupPassword-CyNEA67V.js"])))=>i.map(i=>d[i]);
import{r as b,c as N,o as S,a as M,b as H,w as xe,e as J,F as de,f as Ee,u as k,n as ie,t as Z,g as R,i as Oe,T as Ae,j as fe,k as D,l as Le,m as Ie,p as Me,q as he,s as De,v as j,x as Ne}from"./vendor-CQEko2iO.js";import{i as Re,a as Ue,b as Fe,c as $e,d as je,F as Be}from"./fullcalendar-PBRWkKLf.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&c(t)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const Je=5,O=b([]);let Ve=0;function K(){function e(i,d="info",l=null,m=5e3){if(!i)return;const _=++Ve,p={id:_,message:i,type:d,title:l,visible:!0};for(O.value.push(p);O.value.length>Je;)O.value.shift();return m>0&&setTimeout(()=>{n(_)},m),_}function n(i){const d=O.value.findIndex(l=>l.id===i);d>-1&&O.value.splice(d,1)}function s(i,d=null,l=5e3){return e(i,"success",d,l)}function c(i,d=null,l=8e3){return e(i,"error",d,l)}function r(i,d=null,l=6e3){return e(i,"warning",d,l)}function a(i,d=null,l=5e3){return e(i,"info",d,l)}function t(){O.value.splice(0)}return{toasts:O,addToast:e,removeToast:n,success:s,error:c,warning:r,info:a,clear:t}}const Ge=(e,n)=>{const s=e.__vccOpts||e;for(const[c,r]of n)s[c]=r;return s},ze={class:"toast-container fixed top-5 right-5 pointer-events-auto"},qe={class:"flex items-start gap-3"},We={class:"flex-1 text-sm text-gray-800 dark:text-gray-200 leading-relaxed"},He={key:0,class:"font-bold mb-1 text-sm text-gray-800 dark:text-gray-100"},Qe=["onClick"],Ke={__name:"Toast",setup(e){const{toasts:n,removeToast:s}=K();function c(r){const a={success:"✓",error:"✕",warning:"⚠",info:"ℹ"};return a[r]||a.info}return(r,a)=>(S(),N(Ae,{to:"body"},[M("div",ze,[H(Oe,{name:"toast",tag:"div"},{default:xe(()=>[(S(!0),J(de,null,Ee(k(n),t=>(S(),J("div",{key:t.id,class:ie(["bg-white border border-gray-300 rounded shadow-lg p-3 mb-3 min-w-[300px] max-w-[450px] pointer-events-auto relative font-inherit dark:bg-gray-800 dark:border-gray-600",t.type==="success"?"border-l-4 border-l-green-500":"",t.type==="error"?"border-l-4 border-l-red-500":"",t.type==="warning"?"border-l-4 border-l-yellow-500":"",t.type==="info"?"border-l-4 border-l-blue-500":""])},[M("div",qe,[M("div",{class:ie(["text-lg leading-none flex-shrink-0 mt-0.5",t.type==="success"?"text-green-500":"",t.type==="error"?"text-red-500":"",t.type==="warning"?"text-yellow-500":"",t.type==="info"?"text-blue-500":""])},Z(c(t.type)),3),M("div",We,[t.title?(S(),J("div",He,Z(t.title),1)):R("",!0),M("div",null,Z(t.message),1)])]),M("button",{class:"absolute top-1.5 right-2 bg-none border-none text-base text-gray-500 cursor-pointer p-1 w-6 h-6 flex items-center justify-center leading-none rounded hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700",onClick:i=>k(s)(t.id)}," × ",8,Qe)],2))),128))]),_:1})])]))}},Xe=Ge(Ke,[["__scopeId","data-v-b53fc0a3"]]),Ye="modulepreload",Ze=function(e){return"/"+e},le={},B=function(n,s,c){let r=Promise.resolve();if(s&&s.length>0){let d=function(l){return Promise.all(l.map(m=>Promise.resolve(m).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),i=t?.nonce||t?.getAttribute("nonce");r=d(s.map(l=>{if(l=Ze(l),l in le)return;le[l]=!0;const m=l.endsWith(".css"),_=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${_}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":Ye,m||(p.as="script"),p.crossOrigin="",p.href=l,i&&p.setAttribute("nonce",i),document.head.appendChild(p),m)return new Promise((C,v)=>{p.addEventListener("load",C),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(t){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=t,window.dispatchEvent(i),!i.defaultPrevented)throw t}return r.then(t=>{for(const i of t||[])i.status==="rejected"&&a(i.reason);return n().catch(a)})},et={},tt=et?.VITE_API_BASE||"";function nt(e,n){const c=/^https?:\/\//i.test(e)?e:`${tt}${e}`,r=new URL(c,window.location.origin);return n&&typeof n=="object"&&Object.entries(n).forEach(([a,t])=>{t!=null&&r.searchParams.set(a,String(t))}),r.toString()}async function w(e,n={}){const{method:s="GET",body:c,headers:r={},params:a,signal:t,timeoutMs:i=15e3,credentials:d="include"}=n,l=new AbortController,m=setTimeout(()=>l.abort(),i);t&&(t.aborted?l.abort():t.addEventListener("abort",()=>l.abort(),{once:!0}));const p=c!=null&&/^(POST|PUT|PATCH)$/i.test(s),C=nt(e,a),v=await fetch(C,{method:s,credentials:d,headers:{...p?{"Content-Type":"application/json"}:{},...r},body:p?c:void 0,signal:l.signal}).catch(g=>{throw clearTimeout(m),g});clearTimeout(m);const P=(v.headers.get("content-type")||"").includes("application/json"),A=v.status===204;let y;if(!A)try{y=P?await v.json():await v.text()}catch{y=null}const x=(g,E,$="",X=null)=>({success:g,message:$,errors:X,data:E,status:v.status});if(v.ok)return P&&y&&typeof y=="object"&&"success"in y?{...y,status:v.status}:x(!0,A?null:y??null);if(P&&y&&typeof y=="object"){const g=y.message||v.statusText,E=y.errors||null,$=y.data??null;return x(!1,$,g,E)}return x(!1,null,v.statusText||"Request failed",null)}const te={auth:{async me(){return w("/api/auth/me")},async login(e){return w("/api/auth",{method:"POST",body:JSON.stringify({password:e})})},async logout(){return w("/api/auth/logout",{method:"POST"})},async setupPassword(e,n){return w("/api/auth/password",{method:"POST",body:JSON.stringify({password:e,confirmPassword:n})})},async changePassword(e,n,s){return w("/api/auth/password",{method:"PUT",body:JSON.stringify({currentPassword:e,newPassword:n,confirmPassword:s})})}},calendar:{async create(e){return w("/api/calendars",{method:"POST",body:JSON.stringify({name:e.name,url:e.url,color:e.color,visible_to_public:e.visible_to_public!==void 0?e.visible_to_public:!0,show_details_to_public:e.show_details_to_public!==void 0?e.show_details_to_public:!0})})},async update(e,n){return w(`/api/calendars/${e}`,{method:"PUT",body:JSON.stringify({name:n.name,url:n.url,color:n.color,visible_to_public:n.visible_to_public,show_details_to_public:n.show_details_to_public})})},async delete(e){return w(`/api/calendars/${e}`,{method:"DELETE"})},async import(e){return w("/api/calendars/import",{method:"POST",body:JSON.stringify({calendars:e})})},async export(){return w("/api/calendars/export")},async refresh(){return w("/api/calendars/refresh",{method:"POST"})}},settings:{async getCronSettings(){return w("/api/settings/cron")},async updateCronSettings(e,n){return w("/api/settings/cron",{method:"PUT",body:JSON.stringify({enabled:e,schedule:n})})},async updateTheme(e){return w("/api/settings/theme",{method:"PUT",body:JSON.stringify({theme:e})})},async regenerateFeedToken(){return w("/api/settings/feed-token/regenerate",{method:"POST"})},async updateFeedCalendars(e){return w("/api/settings/feed-token/calendars",{method:"PUT",body:JSON.stringify({calendars:e})})}}},ee=!1;function me(e=""){const n=e?`[${e}]`:"";return{log:(...s)=>ee,info:(...s)=>ee,warn:(...s)=>ee,error:(...s)=>console.error(n,...s)}}const Q="calendar_app_cache",rt=1440*60*1e3,T=me("AuthStore"),f=fe({isAuthenticated:!1,isPasswordConfigured:null,cronSettings:null,theme:"system",feedToken:null,isSyncing:!1});function st(){try{const e=localStorage.getItem(Q);if(e){const n=JSON.parse(e);return n._cachedAt&&Date.now()-n._cachedAt>rt?(T.log("Cache expired"),localStorage.removeItem(Q),null):(T.log("Cache hit:",Object.keys(n)),n)}return T.log("Cache miss"),null}catch(e){return T.error("Cache read error:",e.message),null}}function ot(e){try{const{feedToken:n,calendars:s,...c}=e,r=Date.now(),a=r-720*60*60*1e3,t=r+720*60*60*1e3;c.calendars=(s||[]).map(i=>({...i,events:(i.events||[]).filter(d=>{const l=new Date(d.start).getTime();return l>=a&&l<=t})})),c._cachedAt=Date.now(),localStorage.setItem(Q,JSON.stringify(c)),T.log("Cache set")}catch(n){T.error("Cache write error:",n.message)}}function ce(){try{localStorage.removeItem(Q),T.log("Cache cleared")}catch(e){T.error("Cache clear error:",e.message)}}function ue(e){f.isAuthenticated=!!e.isAuthenticated,f.isPasswordConfigured=!!e.isPasswordConfigured,f.cronSettings=e.cronSettings||null,f.theme=e.theme||"system",f.feedToken=e.feedToken||null}function ge(){const e=K();async function n(){const t=st();return t?(ue(t),{calendars:t.calendars||[],fromCache:!0,sync:()=>s()}):{calendars:await s(),fromCache:!1,sync:null}}async function s(){f.isSyncing=!0;try{const t=await te.auth.me();return t?.success?(T.log("Fresh data received:",Object.keys(t.data)),T.log("isAuthenticated:",t.data.isAuthenticated),ue(t.data),ot(t.data),t.data.calendars||[]):(T.error("Fetch failed - success:",t?.success,"status:",t?.status),[])}catch(t){return T.error("Fetch error:",t.message),e.error("Failed to load app"),[]}finally{f.isSyncing=!1}}async function c(){try{const t=await te.auth.logout();return t.success?(f.isAuthenticated=!1,f.isPasswordConfigured=null,f.cronSettings=null,f.theme="system",f.feedToken=null,ce(),e.success(t.message||"Logged out successfully"),!0):(e.error(t.message||"Failed to logout"),!1)}catch(t){return e.error("Logout error: "+t.message),!1}}function r(t){f.feedToken=t}function a(t){f.feedToken&&(f.feedToken.calendars=t)}return{isAuthenticated:D(f,"isAuthenticated"),isPasswordConfigured:D(f,"isPasswordConfigured"),cronSettings:D(f,"cronSettings"),theme:D(f,"theme"),feedToken:D(f,"feedToken"),isSyncing:D(f,"isSyncing"),initialize:n,logout:c,setPasswordConfigured:t=>f.isPasswordConfigured=t,setTheme:t=>f.theme=t,setFeedToken:r,setFeedCalendars:a,clearCache:ce}}let V=null,G=null;function at(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function U(e){const n=document.documentElement;(e==="system"?at():e)==="dark"?n.classList.add("dark"):n.classList.remove("dark")}function it(e){typeof window>"u"||(G=window.matchMedia("(prefers-color-scheme: dark)"),V=()=>{e.theme.value==="system"&&U("system")},G.addEventListener("change",V))}function lt(){G&&V&&(G.removeEventListener("change",V),G=null,V=null)}function ct(){const e=ge();function n(){U(e.theme.value),it(e),Ie(()=>e.theme.value,c=>{U(c)})}async function s(c){const r=e.theme.value;e.setTheme(c),U(c);try{(await te.settings.updateTheme(c)).success||(e.setTheme(r),U(r))}catch{e.setTheme(r),U(r)}}return Le(()=>{lt()}),{theme:e.theme,initialize:n,setTheme:s}}const ut={class:"h-screen w-screen"},dt={__name:"Calendar",setup(e){const n=j(()=>B(()=>import("./ModalPassword-Cdtp_CvD.js"),__vite__mapDeps([0,1,2,3,4,5]))),s=j(()=>B(()=>import("./ModalSettings-Dguxsjt8.js"),__vite__mapDeps([6,1,2,3,4,5]))),c=j(()=>B(()=>import("./ModalEvent-DPq7BoQc.js"),__vite__mapDeps([7,2,1,3,5]))),r=j(()=>B(()=>import("./ModalConfirm-oeKXVKLM.js"),__vite__mapDeps([8,2,1,3,5]))),a=j(()=>B(()=>import("./ModalSetupPassword-CyNEA67V.js"),__vite__mapDeps([9,1,2,3,4,5]))),t=K(),i=me("Calendar"),d=ge(),{initialize:l}=ct(),m=b([]),_=Me("calendarRef"),p=b([]),C=b(!1),v=b(!1),F=b(!1),P=b(!1),A=b(null),y=b(null),x=b("calendars"),g=fe({show:!1,title:"",message:"",type:"default",confirmText:"Confirm",resolve:null,reject:()=>{g.show=!1,g.resolve=null,g.reject=null}}),E={month:"dayGridMonth",week:"timeGridWeek",day:"timeGridDay",list:"listMonth"};function $(){const o=new URLSearchParams(window.location.search);return E[o.get("view")]||"timeGridWeek"}function X(){return new URLSearchParams(window.location.search).get("date")||void 0}const pe=b({plugins:[Re,Ue,Fe,$e,je],initialView:$(),initialDate:X(),firstDay:1,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth settingsButton"},customButtons:{settingsButton:{text:"settings",hint:"Manage Calendars",click:ve}},height:"100%",nowIndicator:!0,expandRows:!0,editable:!1,selectable:!1,selectMirror:!1,businessHours:{daysOfWeek:[1,2,3,4,5],startTime:"09:00",endTime:"17:00"},eventSources:[],eventClick:_e,eventSourceFailure:Te,datesSet:re});async function ve(){d.isPasswordConfigured.value===!1?P.value=!0:(x.value=d.isAuthenticated.value?"calendars":"about",v.value=!0)}function ye(){C.value=!0}function we(){P.value=!1,d.setPasswordConfigured(!0),C.value=!0}function _e(o){if(o.jsEvent.preventDefault(),!d.isAuthenticated.value&&o.event.extendedProps&&!o.event.extendedProps.show_details_to_public)return;const u=p.value.find(h=>h.id==o.event.source.id);A.value=o.event,y.value=u,F.value=!0}function be(){F.value=!1,A.value=null,y.value=null}function Te(o){console.error("Calendar load failed:",o),t.error("Failed to load calendar events")}async function Se(){C.value=!1,d.clearCache();const{calendars:o}=await d.initialize();m.value=o,z(o),v.value&&(x.value="calendars")}function z(o){const u=_.value?.getApi();if(u){u.removeAllEventSources(),p.value=[];for(const h of o)h?.id&&(u.addEventSource({id:h.id,events:h.events||[],color:h.color}),p.value.push({id:h.id,name:h.name,color:h.color}));u.render()}}async function ne(){try{const{calendars:o}=await d.initialize();m.value=o,z(o)}catch{t.error("Failed to load calendars")}}function re(){const o=_.value.getApi();if(!o)return;const u=o.view,h=o.getDate(),q=new Date().toISOString().split("T")[0],I=h.toISOString().split("T")[0],Pe=Object.keys(E).find(ke=>E[ke]===u.type)||"week",W=new URL(window.location);W.searchParams.set("view",Pe),I!==q?W.searchParams.set("date",I):W.searchParams.delete("date"),window.history.replaceState({},"",W.toString())}const Y=b(new Date().toISOString().split("T")[0]),L=b(null);function Ce(o){const u=_.value?.getApi();if(!u)return;!C.value&&!v.value&&!F.value&&!P.value&&!g.show&&u.getDate().toISOString().split("T")[0]===o&&(u.today(),re())}function se(){const o=new Date().toISOString().split("T")[0];if(o===Y.value)return;const u=Y.value;Y.value=o,Ce(u),ae()}function oe(){document.visibilityState==="visible"&&se()}function ae(){L.value&&clearTimeout(L.value);const o=new Date,u=new Date(o);u.setDate(u.getDate()+1),u.setHours(0,0,0,100);const h=u-o;L.value=setTimeout(se,h)}return he(async()=>{const{calendars:o,fromCache:u,sync:h}=await d.initialize();if(i.log("Initialize done, fromCache:",u,"calendars:",o.length),m.value=o,z(o),l(),u&&h){const q=t.info("Syncing...",null,0),I=await h();i.log("Fresh data received, calendars:",I.length),m.value=I,z(I),t.removeToast(q)}document.addEventListener("visibilitychange",oe),ae()}),De(()=>{document.removeEventListener("visibilitychange",oe),L.value&&(clearTimeout(L.value),L.value=null)}),(o,u)=>(S(),J("main",ut,[H(k(Be),{ref_key:"calendarRef",ref:_,options:pe.value},null,8,["options"]),C.value?(S(),N(k(n),{key:0,onClose:u[0]||(u[0]=h=>C.value=!1),onAuthenticated:Se})):R("",!0),v.value?(S(),N(k(s),{key:1,onClose:u[1]||(u[1]=h=>v.value=!1),calendars:m.value,"initial-tab":x.value,"is-authenticated":k(d).isAuthenticated.value,onCalendarUpdated:ne,onShowPasswordModal:ye,onAuthChanged:ne},null,8,["calendars","initial-tab","is-authenticated"])):R("",!0),F.value?(S(),N(k(c),{key:2,event:A.value,calendar:y.value,onClose:be},null,8,["event","calendar"])):R("",!0),g.show?(S(),N(k(r),{key:3,title:g.title,message:g.message,type:g.type,"confirm-text":g.confirmText,onConfirm:g.resolve,onCancel:g.reject},null,8,["title","message","type","confirm-text","onConfirm","onCancel"])):R("",!0),P.value?(S(),N(k(a),{key:4,onClose:u[2]||(u[2]=h=>P.value=!1),onPasswordConfigured:we})):R("",!0)]))}},ft={__name:"App",setup(e){const n=K();return he(()=>{const s=window.location.pathname;s!=="/"&&(n.error(`Page not found: ${s}`,"Not Found"),window.history.replaceState({},"","/"))}),(s,c)=>(S(),J(de,null,[H(dt),H(Xe)],64))}},ht=Ne(ft);ht.mount("#app");export{Ge as _,te as a,ge as b,ct as c,K as u};
