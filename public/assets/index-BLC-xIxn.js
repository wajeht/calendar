const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModalPassword-Dn1ljLfn.js","assets/vendor-CQEko2iO.js","assets/Button-CbrUf6yk.js","assets/Button-A5E1YjHX.css","assets/Input-ZV2_aOD0.js","assets/fullcalendar-PBRWkKLf.js","assets/ModalSettings-BTwn7kI8.js","assets/ModalEvent-BHnzTRRr.js","assets/ModalConfirm-C8stuQaa.js","assets/ModalSetupPassword-DBwViljZ.js"])))=>i.map(i=>d[i]);
import{r as b,c as N,o as S,a as M,b as H,w as xe,e as J,F as de,f as Ee,u as P,n as ie,t as Z,g as R,i as Oe,T as Ae,j as fe,k as D,l as Le,m as Ie,p as Me,q as he,s as De,v as j,x as Ne}from"./vendor-CQEko2iO.js";import{i as Re,a as Ue,b as Fe,c as $e,d as je,F as Be}from"./fullcalendar-PBRWkKLf.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const t of i.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&u(t)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const Je=5,O=b([]);let Ve=0;function K(){function e(l,d="info",c=null,m=5e3){if(!l)return;const _=++Ve,p={id:_,message:l,type:d,title:c,visible:!0};for(O.value.push(p);O.value.length>Je;)O.value.shift();return m>0&&setTimeout(()=>{n(_)},m),_}function n(l){const d=O.value.findIndex(c=>c.id===l);d>-1&&O.value.splice(d,1)}function s(l,d=null,c=5e3){return e(l,"success",d,c)}function u(l,d=null,c=8e3){return e(l,"error",d,c)}function r(l,d=null,c=6e3){return e(l,"warning",d,c)}function i(l,d=null,c=5e3){return e(l,"info",d,c)}function t(){O.value.splice(0)}return{toasts:O,addToast:e,removeToast:n,success:s,error:u,warning:r,info:i,clear:t}}const Ge=(e,n)=>{const s=e.__vccOpts||e;for(const[u,r]of n)s[u]=r;return s},ze={class:"toast-container fixed top-5 right-5 pointer-events-auto"},qe={class:"flex items-start gap-3"},We={class:"flex-1 text-sm text-gray-800 dark:text-gray-200 leading-relaxed"},He={key:0,class:"font-bold mb-1 text-sm text-gray-800 dark:text-gray-100"},Qe=["onClick"],Ke={__name:"Toast",setup(e){const{toasts:n,removeToast:s}=K();function u(r){const i={success:"✓",error:"✕",warning:"⚠",info:"ℹ"};return i[r]||i.info}return(r,i)=>(S(),N(Ae,{to:"body"},[M("div",ze,[H(Oe,{name:"toast",tag:"div"},{default:xe(()=>[(S(!0),J(de,null,Ee(P(n),t=>(S(),J("div",{key:t.id,class:ie(["bg-white border border-gray-300 rounded shadow-lg p-3 mb-3 min-w-[300px] max-w-[450px] pointer-events-auto relative font-inherit dark:bg-gray-800 dark:border-gray-600",t.type==="success"?"border-l-4 border-l-green-500":"",t.type==="error"?"border-l-4 border-l-red-500":"",t.type==="warning"?"border-l-4 border-l-yellow-500":"",t.type==="info"?"border-l-4 border-l-blue-500":""])},[M("div",qe,[M("div",{class:ie(["text-lg leading-none flex-shrink-0 mt-0.5",t.type==="success"?"text-green-500":"",t.type==="error"?"text-red-500":"",t.type==="warning"?"text-yellow-500":"",t.type==="info"?"text-blue-500":""])},Z(u(t.type)),3),M("div",We,[t.title?(S(),J("div",He,Z(t.title),1)):R("",!0),M("div",null,Z(t.message),1)])]),M("button",{class:"absolute top-1.5 right-2 bg-none border-none text-base text-gray-500 cursor-pointer p-1 w-6 h-6 flex items-center justify-center leading-none rounded hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700",onClick:l=>P(s)(t.id)}," × ",8,Qe)],2))),128))]),_:1})])]))}},Xe=Ge(Ke,[["__scopeId","data-v-b53fc0a3"]]),Ye="modulepreload",Ze=function(e){return"/"+e},le={},B=function(n,s,u){let r=Promise.resolve();if(s&&s.length>0){let d=function(c){return Promise.all(c.map(m=>Promise.resolve(m).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),l=t?.nonce||t?.getAttribute("nonce");r=d(s.map(c=>{if(c=Ze(c),c in le)return;le[c]=!0;const m=c.endsWith(".css"),_=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${_}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":Ye,m||(p.as="script"),p.crossOrigin="",p.href=c,l&&p.setAttribute("nonce",l),document.head.appendChild(p),m)return new Promise((T,v)=>{p.addEventListener("load",T),p.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(t){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=t,window.dispatchEvent(l),!l.defaultPrevented)throw t}return r.then(t=>{for(const l of t||[])l.status==="rejected"&&i(l.reason);return n().catch(i)})},et={},tt=et?.VITE_API_BASE||"";function nt(e,n){const u=/^https?:\/\//i.test(e)?e:`${tt}${e}`,r=new URL(u,window.location.origin);return n&&typeof n=="object"&&Object.entries(n).forEach(([i,t])=>{t!=null&&r.searchParams.set(i,String(t))}),r.toString()}async function w(e,n={}){const{method:s="GET",body:u,headers:r={},params:i,signal:t,timeoutMs:l=15e3,credentials:d="include"}=n,c=new AbortController,m=setTimeout(()=>c.abort(),l);t&&(t.aborted?c.abort():t.addEventListener("abort",()=>c.abort(),{once:!0}));const p=u!=null&&/^(POST|PUT|PATCH)$/i.test(s),T=nt(e,i),v=await fetch(T,{method:s,credentials:d,headers:{...p?{"Content-Type":"application/json"}:{},...r},body:p?u:void 0,signal:c.signal}).catch(g=>{throw clearTimeout(m),g});clearTimeout(m);const C=(v.headers.get("content-type")||"").includes("application/json"),A=v.status===204;let y;if(!A)try{y=C?await v.json():await v.text()}catch{y=null}const x=(g,E,$="",X=null)=>({success:g,message:$,errors:X,data:E,status:v.status});if(v.ok)return C&&y&&typeof y=="object"&&"success"in y?{...y,status:v.status}:x(!0,A?null:y??null);if(C&&y&&typeof y=="object"){const g=y.message||v.statusText,E=y.errors||null,$=y.data??null;return x(!1,$,g,E)}return x(!1,null,v.statusText||"Request failed",null)}const te={auth:{async me(){return w("/api/auth/me")},async login(e){return w("/api/auth",{method:"POST",body:JSON.stringify({password:e})})},async logout(){return w("/api/auth/logout",{method:"POST"})},async setupPassword(e,n){return w("/api/auth/password",{method:"POST",body:JSON.stringify({password:e,confirmPassword:n})})},async changePassword(e,n,s){return w("/api/auth/password",{method:"PUT",body:JSON.stringify({currentPassword:e,newPassword:n,confirmPassword:s})})}},calendar:{async create(e){return w("/api/calendars",{method:"POST",body:JSON.stringify({name:e.name,url:e.url,color:e.color,visible_to_public:e.visible_to_public!==void 0?e.visible_to_public:!0,show_details_to_public:e.show_details_to_public!==void 0?e.show_details_to_public:!0})})},async update(e,n){return w(`/api/calendars/${e}`,{method:"PUT",body:JSON.stringify({name:n.name,url:n.url,color:n.color,visible_to_public:n.visible_to_public,show_details_to_public:n.show_details_to_public})})},async delete(e){return w(`/api/calendars/${e}`,{method:"DELETE"})},async import(e){return w("/api/calendars/import",{method:"POST",body:JSON.stringify({calendars:e})})},async export(){return w("/api/calendars/export")},async refresh(){return w("/api/calendars/refresh",{method:"POST"})}},settings:{async getCronSettings(){return w("/api/settings/cron")},async updateCronSettings(e,n){return w("/api/settings/cron",{method:"PUT",body:JSON.stringify({enabled:e,schedule:n})})},async updateTheme(e){return w("/api/settings/theme",{method:"PUT",body:JSON.stringify({theme:e})})},async regenerateFeedToken(){return w("/api/settings/feed-token/regenerate",{method:"POST"})},async updateFeedCalendars(e){return w("/api/settings/feed-token/calendars",{method:"PUT",body:JSON.stringify({calendars:e})})}}},ee=!1;function me(e=""){const n=e?`[${e}]`:"";return{log:(...s)=>ee,info:(...s)=>ee,warn:(...s)=>ee,error:(...s)=>console.error(n,...s)}}const Q="calendar_app_cache",st=300*1e3,k=me("AuthStore"),f=fe({isAuthenticated:!1,isPasswordConfigured:null,cronSettings:null,theme:"system",feedToken:null,isSyncing:!1});function rt(){try{const e=localStorage.getItem(Q);if(e){const n=JSON.parse(e);return n._cachedAt&&Date.now()-n._cachedAt>st?(k.log("Cache expired"),localStorage.removeItem(Q),null):(k.log("Cache hit:",Object.keys(n)),n)}return k.log("Cache miss"),null}catch{return null}}function ot(e){try{const{feedToken:n,...s}=e;s._cachedAt=Date.now(),localStorage.setItem(Q,JSON.stringify(s)),k.log("Cache set:",Object.keys(s))}catch{}}function ce(){try{localStorage.removeItem(Q),k.log("Cache cleared")}catch{}}function ue(e){f.isAuthenticated=!!e.isAuthenticated,f.isPasswordConfigured=!!e.isPasswordConfigured,f.cronSettings=e.cronSettings||null,f.theme=e.theme||"system",f.feedToken=e.feedToken||null}function ge(){const e=K();async function n(){const t=rt();return t?(ue(t),{calendars:t.calendars||[],fromCache:!0,sync:()=>s()}):{calendars:await s(),fromCache:!1,sync:null}}async function s(){f.isSyncing=!0;try{const t=await te.auth.me();return t?.success?(k.log("Fresh data received:",Object.keys(t.data)),ue(t.data),ot(t.data),t.data.calendars||[]):(k.log("Fetch failed - no success"),[])}catch(t){return k.error("Fetch error:",t.message),e.error("Failed to load app"),[]}finally{f.isSyncing=!1}}async function u(){try{const t=await te.auth.logout();return t.success?(f.isAuthenticated=!1,f.isPasswordConfigured=null,f.cronSettings=null,f.theme="system",f.feedToken=null,ce(),e.success(t.message||"Logged out successfully"),!0):(e.error(t.message||"Failed to logout"),!1)}catch(t){return e.error("Logout error: "+t.message),!1}}function r(t){f.feedToken=t}function i(t){f.feedToken&&(f.feedToken.calendars=t)}return{isAuthenticated:D(f,"isAuthenticated"),isPasswordConfigured:D(f,"isPasswordConfigured"),cronSettings:D(f,"cronSettings"),theme:D(f,"theme"),feedToken:D(f,"feedToken"),isSyncing:D(f,"isSyncing"),initialize:n,logout:u,setPasswordConfigured:t=>f.isPasswordConfigured=t,setTheme:t=>f.theme=t,setFeedToken:r,setFeedCalendars:i,clearCache:ce}}let V=null,G=null;function at(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function U(e){const n=document.documentElement;(e==="system"?at():e)==="dark"?n.classList.add("dark"):n.classList.remove("dark")}function it(e){typeof window>"u"||(G=window.matchMedia("(prefers-color-scheme: dark)"),V=()=>{e.theme.value==="system"&&U("system")},G.addEventListener("change",V))}function lt(){G&&V&&(G.removeEventListener("change",V),G=null,V=null)}function ct(){const e=ge();function n(){U(e.theme.value),it(e),Ie(()=>e.theme.value,u=>{U(u)})}async function s(u){const r=e.theme.value;e.setTheme(u),U(u);try{(await te.settings.updateTheme(u)).success||(e.setTheme(r),U(r))}catch{e.setTheme(r),U(r)}}return Le(()=>{lt()}),{theme:e.theme,initialize:n,setTheme:s}}const ut={class:"h-screen w-screen"},dt={__name:"Calendar",setup(e){const n=j(()=>B(()=>import("./ModalPassword-Dn1ljLfn.js"),__vite__mapDeps([0,1,2,3,4,5]))),s=j(()=>B(()=>import("./ModalSettings-BTwn7kI8.js"),__vite__mapDeps([6,1,2,3,4,5]))),u=j(()=>B(()=>import("./ModalEvent-BHnzTRRr.js"),__vite__mapDeps([7,2,1,3,5]))),r=j(()=>B(()=>import("./ModalConfirm-C8stuQaa.js"),__vite__mapDeps([8,2,1,3,5]))),i=j(()=>B(()=>import("./ModalSetupPassword-DBwViljZ.js"),__vite__mapDeps([9,1,2,3,4,5]))),t=K(),l=me("Calendar"),d=ge(),{initialize:c}=ct(),m=b([]),_=Me("calendarRef"),p=b([]),T=b(!1),v=b(!1),F=b(!1),C=b(!1),A=b(null),y=b(null),x=b("calendars"),g=fe({show:!1,title:"",message:"",type:"default",confirmText:"Confirm",resolve:null,reject:()=>{g.show=!1,g.resolve=null,g.reject=null}}),E={month:"dayGridMonth",week:"timeGridWeek",day:"timeGridDay",list:"listMonth"},$=b({plugins:[Re,Ue,Fe,$e,je],initialView:X(),initialDate:pe(),firstDay:1,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth settingsButton"},customButtons:{settingsButton:{text:"settings",hint:"Manage Calendars",click:ve}},height:"100%",nowIndicator:!0,expandRows:!0,editable:!1,selectable:!1,selectMirror:!1,businessHours:{daysOfWeek:[1,2,3,4,5],startTime:"09:00",endTime:"17:00"},eventSources:[],eventClick:_e,eventSourceFailure:Se,datesSet:se});function X(){const a=new URLSearchParams(window.location.search).get("view");return E[a]||"timeGridWeek"}function pe(){return new URLSearchParams(window.location.search).get("date")||void 0}async function ve(){d.isPasswordConfigured.value===!1?C.value=!0:(x.value=d.isAuthenticated.value?"calendars":"about",v.value=!0)}function ye(){T.value=!0}function we(){C.value=!1,d.setPasswordConfigured(!0),T.value=!0}function _e(o){if(o.jsEvent.preventDefault(),!d.isAuthenticated.value&&o.event.extendedProps&&!o.event.extendedProps.show_details_to_public)return;const a=p.value.find(h=>h.id==o.event.source.id);A.value=o.event,y.value=a,F.value=!0}function be(){F.value=!1,A.value=null,y.value=null}function Se(o){console.error("Calendar load failed:",o),t.error("Failed to load calendar events")}async function Te(){T.value=!1,d.clearCache();const{calendars:o}=await d.initialize();m.value=o,z(o),v.value&&(x.value="calendars")}function z(o){const a=_.value?.getApi();if(a){a.removeAllEventSources(),p.value=[];for(const h of o)h?.id&&(a.addEventSource({id:h.id,events:h.events||[],color:h.color}),p.value.push({id:h.id,name:h.name,color:h.color}));a.render()}}async function ne(){try{const{calendars:o}=await d.initialize();m.value=o,z(o)}catch{t.error("Failed to load calendars")}}function se(){const o=_.value.getApi();if(!o)return;const a=o.view,h=o.getDate(),q=new Date().toISOString().split("T")[0],I=h.toISOString().split("T")[0],Pe=Object.keys(E).find(ke=>E[ke]===a.type)||"week",W=new URL(window.location);W.searchParams.set("view",Pe),I!==q?W.searchParams.set("date",I):W.searchParams.delete("date"),window.history.replaceState({},"",W.toString())}const Y=b(new Date().toISOString().split("T")[0]),L=b(null);function Ce(o){const a=_.value?.getApi();if(!a)return;!T.value&&!v.value&&!F.value&&!C.value&&!g.show&&a.getDate().toISOString().split("T")[0]===o&&(a.today(),se())}function re(){const o=new Date().toISOString().split("T")[0];if(o===Y.value)return;const a=Y.value;Y.value=o,Ce(a),ae()}function oe(){document.visibilityState==="visible"&&re()}function ae(){L.value&&clearTimeout(L.value);const o=new Date,a=new Date(o);a.setDate(a.getDate()+1),a.setHours(0,0,0,100);const h=a-o;L.value=setTimeout(re,h)}return he(async()=>{const{calendars:o,fromCache:a,sync:h}=await d.initialize();if(l.log("Initialize done, fromCache:",a,"calendars:",o.length),m.value=o,z(o),c(),a&&h){const q=t.info("Syncing...",null,0),I=await h();l.log("Fresh data received, calendars:",I.length),m.value=I,z(I),t.removeToast(q)}document.addEventListener("visibilitychange",oe),ae()}),De(()=>{document.removeEventListener("visibilitychange",oe),L.value&&(clearTimeout(L.value),L.value=null)}),(o,a)=>(S(),J("main",ut,[H(P(Be),{ref_key:"calendarRef",ref:_,options:$.value},null,8,["options"]),T.value?(S(),N(P(n),{key:0,onClose:a[0]||(a[0]=h=>T.value=!1),onAuthenticated:Te})):R("",!0),v.value?(S(),N(P(s),{key:1,onClose:a[1]||(a[1]=h=>v.value=!1),calendars:m.value,"initial-tab":x.value,"is-authenticated":P(d).isAuthenticated.value,onCalendarUpdated:ne,onShowPasswordModal:ye,onAuthChanged:ne},null,8,["calendars","initial-tab","is-authenticated"])):R("",!0),F.value?(S(),N(P(u),{key:2,event:A.value,calendar:y.value,onClose:be},null,8,["event","calendar"])):R("",!0),g.show?(S(),N(P(r),{key:3,title:g.title,message:g.message,type:g.type,"confirm-text":g.confirmText,onConfirm:g.resolve,onCancel:g.reject},null,8,["title","message","type","confirm-text","onConfirm","onCancel"])):R("",!0),C.value?(S(),N(P(i),{key:4,onClose:a[2]||(a[2]=h=>C.value=!1),onPasswordConfigured:we})):R("",!0)]))}},ft={__name:"App",setup(e){const n=K();return he(()=>{const s=window.location.pathname;s!=="/"&&(n.error(`Page not found: ${s}`,"Not Found"),window.history.replaceState({},"","/"))}),(s,u)=>(S(),J(de,null,[H(dt),H(Xe)],64))}},ht=Ne(ft);ht.mount("#app");export{Ge as _,te as a,ge as b,ct as c,K as u};
