const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModalPassword-G5TcCCYj.js","assets/vendor-CQEko2iO.js","assets/Button-BnIkoBTp.js","assets/Button-A5E1YjHX.css","assets/Input-ZV2_aOD0.js","assets/fullcalendar-PBRWkKLf.js","assets/ModalSettings-YSrHG-v5.js","assets/ModalEvent-B4MZgIC9.js","assets/ModalConfirm-CUdj8TFM.js","assets/ModalSetupPassword-DDiIoLby.js"])))=>i.map(i=>d[i]);
import{r as b,c as M,o as T,a as L,b as G,w as _e,e as F,F as ae,f as be,u as C,n as oe,t as H,g as I,i as Te,T as Se,j as ie,k as D,l as Pe,m as Ce,p as ke,q as le,s as xe,v as $,x as Ee}from"./vendor-CQEko2iO.js";import{i as Oe,a as Ae,b as Le,c as Me,d as Ie,F as Ne}from"./fullcalendar-PBRWkKLf.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&u(o)}).observe(document,{childList:!0,subtree:!0});function l(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(s){if(s.ep)return;s.ep=!0;const t=l(s);fetch(s.href,t)}})();const Re=5,x=b([]);let Ue=0;function z(){function e(r,m="info",i=null,h=5e3){if(!r)return;const _=++Ue,d={id:_,message:r,type:m,title:i,visible:!0};for(x.value.push(d);x.value.length>Re;)x.value.shift();return h>0&&setTimeout(()=>{n(_)},h),_}function n(r){const m=x.value.findIndex(i=>i.id===r);m>-1&&x.value.splice(m,1)}function l(r,m=null,i=5e3){return e(r,"success",m,i)}function u(r,m=null,i=8e3){return e(r,"error",m,i)}function s(r,m=null,i=6e3){return e(r,"warning",m,i)}function t(r,m=null,i=5e3){return e(r,"info",m,i)}function o(){x.value.splice(0)}return{toasts:x,addToast:e,removeToast:n,success:l,error:u,warning:s,info:t,clear:o}}const De=(e,n)=>{const l=e.__vccOpts||e;for(const[u,s]of n)l[u]=s;return l},$e={class:"toast-container fixed top-5 right-5 pointer-events-auto"},je={class:"flex items-start gap-3"},Fe={class:"flex-1 text-sm text-gray-800 dark:text-gray-200 leading-relaxed"},Be={key:0,class:"font-bold mb-1 text-sm text-gray-800 dark:text-gray-100"},Je=["onClick"],Ve={__name:"Toast",setup(e){const{toasts:n,removeToast:l}=z();function u(s){const t={success:"✓",error:"✕",warning:"⚠",info:"ℹ"};return t[s]||t.info}return(s,t)=>(T(),M(Se,{to:"body"},[L("div",$e,[G(Te,{name:"toast",tag:"div"},{default:_e(()=>[(T(!0),F(ae,null,be(C(n),o=>(T(),F("div",{key:o.id,class:oe(["bg-white border border-gray-300 rounded shadow-lg p-3 mb-3 min-w-[300px] max-w-[450px] pointer-events-auto relative font-inherit dark:bg-gray-800 dark:border-gray-600",o.type==="success"?"border-l-4 border-l-green-500":"",o.type==="error"?"border-l-4 border-l-red-500":"",o.type==="warning"?"border-l-4 border-l-yellow-500":"",o.type==="info"?"border-l-4 border-l-blue-500":""])},[L("div",je,[L("div",{class:oe(["text-lg leading-none flex-shrink-0 mt-0.5",o.type==="success"?"text-green-500":"",o.type==="error"?"text-red-500":"",o.type==="warning"?"text-yellow-500":"",o.type==="info"?"text-blue-500":""])},H(u(o.type)),3),L("div",Fe,[o.title?(T(),F("div",Be,H(o.title),1)):I("",!0),L("div",null,H(o.message),1)])]),L("button",{class:"absolute top-1.5 right-2 bg-none border-none text-base text-gray-500 cursor-pointer p-1 w-6 h-6 flex items-center justify-center leading-none rounded hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700",onClick:r=>C(l)(o.id)}," × ",8,Je)],2))),128))]),_:1})])]))}},Ge=De(Ve,[["__scopeId","data-v-b53fc0a3"]]),ze="modulepreload",qe=function(e){return"/"+e},re={},j=function(n,l,u){let s=Promise.resolve();if(l&&l.length>0){let m=function(i){return Promise.all(i.map(h=>Promise.resolve(h).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),r=o?.nonce||o?.getAttribute("nonce");s=m(l.map(i=>{if(i=qe(i),i in re)return;re[i]=!0;const h=i.endsWith(".css"),_=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${_}`))return;const d=document.createElement("link");if(d.rel=h?"stylesheet":ze,h||(d.as="script"),d.crossOrigin="",d.href=i,r&&d.setAttribute("nonce",r),document.head.appendChild(d),h)return new Promise((P,v)=>{d.addEventListener("load",P),d.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${i}`)))})}))}function t(o){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o}return s.then(o=>{for(const r of o||[])r.status==="rejected"&&t(r.reason);return n().catch(t)})},We={},Qe=We?.VITE_API_BASE||"";function He(e,n){const u=/^https?:\/\//i.test(e)?e:`${Qe}${e}`,s=new URL(u,window.location.origin);return n&&typeof n=="object"&&Object.entries(n).forEach(([t,o])=>{o!=null&&s.searchParams.set(t,String(o))}),s.toString()}async function y(e,n={}){const{method:l="GET",body:u,headers:s={},params:t,signal:o,timeoutMs:r=15e3,credentials:m="include"}=n,i=new AbortController,h=setTimeout(()=>i.abort(),r);o&&(o.aborted?i.abort():o.addEventListener("abort",()=>i.abort(),{once:!0}));const d=u!=null&&/^(POST|PUT|PATCH)$/i.test(l),P=He(e,t),v=await fetch(P,{method:l,credentials:m,headers:{...d?{"Content-Type":"application/json"}:{},...s},body:d?u:void 0,signal:i.signal}).catch(S=>{throw clearTimeout(h),S});clearTimeout(h);const k=(v.headers.get("content-type")||"").includes("application/json"),O=v.status===204;let g;if(!O)try{g=k?await v.json():await v.text()}catch{g=null}const w=(S,R,U="",q=null)=>({success:S,message:U,errors:q,data:R,status:v.status});if(v.ok)return k&&g&&typeof g=="object"&&"success"in g?{...g,status:v.status}:w(!0,O?null:g??null);if(k&&g&&typeof g=="object"){const S=g.message||v.statusText,R=g.errors||null,U=g.data??null;return w(!1,U,S,R)}return w(!1,null,v.statusText||"Request failed",null)}const K={auth:{async me(){return y("/api/auth/me")},async login(e){return y("/api/auth",{method:"POST",body:JSON.stringify({password:e})})},async logout(){return y("/api/auth/logout",{method:"POST"})},async setupPassword(e,n){return y("/api/auth/password",{method:"POST",body:JSON.stringify({password:e,confirmPassword:n})})},async changePassword(e,n,l){return y("/api/auth/password",{method:"PUT",body:JSON.stringify({currentPassword:e,newPassword:n,confirmPassword:l})})}},calendar:{async create(e){return y("/api/calendars",{method:"POST",body:JSON.stringify({name:e.name,url:e.url,color:e.color,visible_to_public:e.visible_to_public!==void 0?e.visible_to_public:!0,show_details_to_public:e.show_details_to_public!==void 0?e.show_details_to_public:!0})})},async update(e,n){return y(`/api/calendars/${e}`,{method:"PUT",body:JSON.stringify({name:n.name,url:n.url,color:n.color,visible_to_public:n.visible_to_public,show_details_to_public:n.show_details_to_public})})},async delete(e){return y(`/api/calendars/${e}`,{method:"DELETE"})},async import(e){return y("/api/calendars/import",{method:"POST",body:JSON.stringify({calendars:e})})},async export(){return y("/api/calendars/export")},async refresh(){return y("/api/calendars/refresh",{method:"POST"})}},settings:{async getCronSettings(){return y("/api/settings/cron")},async updateCronSettings(e,n){return y("/api/settings/cron",{method:"PUT",body:JSON.stringify({enabled:e,schedule:n})})},async updateTheme(e){return y("/api/settings/theme",{method:"PUT",body:JSON.stringify({theme:e})})},async regenerateFeedToken(){return y("/api/settings/feed-token/regenerate",{method:"POST"})},async updateFeedCalendars(e){return y("/api/settings/feed-token/calendars",{method:"PUT",body:JSON.stringify({calendars:e})})}}},f=ie({isAuthenticated:!1,isPasswordConfigured:null,cronSettings:null,theme:"system",feedToken:null});function ce(){const e=z();async function n(){try{const t=await K.auth.me();return t?.success?(f.isAuthenticated=!!t.data.isAuthenticated,f.isPasswordConfigured=!!t.data.isPasswordConfigured,f.cronSettings=t.data.cronSettings||null,f.theme=t.data.theme||"system",f.feedToken=t.data.feedToken||null,t.data.calendars||[]):[]}catch{return e.error("Failed to load app"),[]}}async function l(){try{const t=await K.auth.logout();return t.success?(f.isAuthenticated=!1,f.isPasswordConfigured=null,f.cronSettings=null,f.theme="system",f.feedToken=null,e.success(t.message||"Logged out successfully"),!0):(e.error(t.message||"Failed to logout"),!1)}catch(t){return e.error("Logout error: "+t.message),!1}}function u(t){f.feedToken=t}function s(t){f.feedToken&&(f.feedToken.calendars=t)}return{isAuthenticated:D(f,"isAuthenticated"),isPasswordConfigured:D(f,"isPasswordConfigured"),cronSettings:D(f,"cronSettings"),theme:D(f,"theme"),feedToken:D(f,"feedToken"),initialize:n,logout:l,setPasswordConfigured:t=>f.isPasswordConfigured=t,setTheme:t=>f.theme=t,setFeedToken:u,setFeedCalendars:s}}let B=null,J=null;function Ke(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function N(e){const n=document.documentElement;(e==="system"?Ke():e)==="dark"?n.classList.add("dark"):n.classList.remove("dark")}function Xe(e){typeof window>"u"||(J=window.matchMedia("(prefers-color-scheme: dark)"),B=()=>{e.theme.value==="system"&&N("system")},J.addEventListener("change",B))}function Ye(){J&&B&&(J.removeEventListener("change",B),J=null,B=null)}function Ze(){const e=ce();function n(){N(e.theme.value),Xe(e),Ce(()=>e.theme.value,u=>{N(u)})}async function l(u){const s=e.theme.value;e.setTheme(u),N(u);try{(await K.settings.updateTheme(u)).success||(e.setTheme(s),N(s))}catch{e.setTheme(s),N(s)}}return Pe(()=>{Ye()}),{theme:e.theme,initialize:n,setTheme:l}}const et={class:"h-screen w-screen"},tt={__name:"Calendar",setup(e){const n=$(()=>j(()=>import("./ModalPassword-G5TcCCYj.js"),__vite__mapDeps([0,1,2,3,4,5]))),l=$(()=>j(()=>import("./ModalSettings-YSrHG-v5.js"),__vite__mapDeps([6,1,2,3,4,5]))),u=$(()=>j(()=>import("./ModalEvent-B4MZgIC9.js"),__vite__mapDeps([7,2,1,3,5]))),s=$(()=>j(()=>import("./ModalConfirm-CUdj8TFM.js"),__vite__mapDeps([8,2,1,3,5]))),t=$(()=>j(()=>import("./ModalSetupPassword-DDiIoLby.js"),__vite__mapDeps([9,1,2,3,4,5]))),o=z(),r=ce(),{initialize:m}=Ze(),i=b([]),h=ke("calendarRef"),_=b([]),d=b(!1),P=b(!1),v=b(!1),E=b(!1),k=b(null),O=b(null),g=b("calendars"),w=ie({show:!1,title:"",message:"",type:"default",confirmText:"Confirm",resolve:null,reject:()=>{w.show=!1,w.resolve=null,w.reject=null}}),S={month:"dayGridMonth",week:"timeGridWeek",day:"timeGridDay",list:"listMonth"},R=b({plugins:[Oe,Ae,Le,Me,Ie],initialView:U(),initialDate:q(),firstDay:1,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth settingsButton"},customButtons:{settingsButton:{text:"settings",hint:"Manage Calendars",click:ue}},height:"100%",nowIndicator:!0,expandRows:!0,editable:!1,selectable:!1,selectMirror:!1,businessHours:{daysOfWeek:[1,2,3,4,5],startTime:"09:00",endTime:"17:00"},eventSources:[],eventClick:me,eventSourceFailure:pe,datesSet:Y});function U(){const c=new URLSearchParams(window.location.search).get("view");return S[c]||"timeGridWeek"}function q(){return new URLSearchParams(window.location.search).get("date")||void 0}async function ue(){r.isPasswordConfigured.value===!1?E.value=!0:(g.value=r.isAuthenticated.value?"calendars":"about",P.value=!0)}function de(){d.value=!0}function fe(){E.value=!1,r.setPasswordConfigured(!0),d.value=!0}function me(a){if(a.jsEvent.preventDefault(),!r.isAuthenticated.value&&a.event.extendedProps&&!a.event.extendedProps.show_details_to_public)return;const c=_.value.find(p=>p.id==a.event.source.id);k.value=a.event,O.value=c,v.value=!0}function he(){v.value=!1,k.value=null,O.value=null}function pe(a){console.error("Calendar load failed:",a),o.error("Failed to load calendar events")}async function ve(){d.value=!1;const a=await r.initialize();i.value=a,W(a),P.value&&(g.value="calendars")}function W(a){const c=h.value?.getApi();if(c){c.removeAllEventSources(),_.value=[];for(const p of a)p?.id&&(c.addEventSource({id:p.id,events:p.events||[],color:p.color}),_.value.push({id:p.id,name:p.name,color:p.color}));c.render()}}async function X(){try{const a=await r.initialize();i.value=a,W(a)}catch{o.error("Failed to load calendars")}}function Y(){const a=h.value.getApi();if(!a)return;const c=a.view,p=a.getDate(),ne=new Date().toISOString().split("T")[0],se=p.toISOString().split("T")[0],ye=Object.keys(S).find(we=>S[we]===c.type)||"week",V=new URL(window.location);V.searchParams.set("view",ye),se!==ne?V.searchParams.set("date",se):V.searchParams.delete("date"),window.history.replaceState({},"",V.toString())}const Q=b(new Date().toISOString().split("T")[0]),A=b(null);function ge(a){const c=h.value?.getApi();if(!c)return;!d.value&&!P.value&&!v.value&&!E.value&&!w.show&&c.getDate().toISOString().split("T")[0]===a&&(c.today(),Y())}function Z(){const a=new Date().toISOString().split("T")[0];if(a===Q.value)return;const c=Q.value;Q.value=a,ge(c),te()}function ee(){document.visibilityState==="visible"&&Z()}function te(){A.value&&clearTimeout(A.value);const a=new Date,c=new Date(a);c.setDate(c.getDate()+1),c.setHours(0,0,0,100);const p=c-a;A.value=setTimeout(Z,p)}return le(async()=>{const a=await r.initialize();i.value=a,W(a),m(),document.addEventListener("visibilitychange",ee),te()}),xe(()=>{document.removeEventListener("visibilitychange",ee),A.value&&(clearTimeout(A.value),A.value=null)}),(a,c)=>(T(),F("main",et,[G(C(Ne),{ref_key:"calendarRef",ref:h,options:R.value},null,8,["options"]),d.value?(T(),M(C(n),{key:0,onClose:c[0]||(c[0]=p=>d.value=!1),onAuthenticated:ve})):I("",!0),P.value?(T(),M(C(l),{key:1,onClose:c[1]||(c[1]=p=>P.value=!1),calendars:i.value,"initial-tab":g.value,"is-authenticated":C(r).isAuthenticated.value,onCalendarUpdated:X,onShowPasswordModal:de,onAuthChanged:X},null,8,["calendars","initial-tab","is-authenticated"])):I("",!0),v.value?(T(),M(C(u),{key:2,event:k.value,calendar:O.value,onClose:he},null,8,["event","calendar"])):I("",!0),w.show?(T(),M(C(s),{key:3,title:w.title,message:w.message,type:w.type,"confirm-text":w.confirmText,onConfirm:w.resolve,onCancel:w.reject},null,8,["title","message","type","confirm-text","onConfirm","onCancel"])):I("",!0),E.value?(T(),M(C(t),{key:4,onClose:c[2]||(c[2]=p=>E.value=!1),onPasswordConfigured:fe})):I("",!0)]))}},nt={__name:"App",setup(e){const n=z();return le(()=>{const l=window.location.pathname;l!=="/"&&(n.error(`Page not found: ${l}`,"Not Found"),window.history.replaceState({},"","/"))}),(l,u)=>(T(),F(ae,null,[G(tt),G(Ge)],64))}},st=Ee(nt);st.mount("#app");export{De as _,K as a,ce as b,Ze as c,z as u};
