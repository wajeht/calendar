const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModalPassword-D1oYOZNt.js","assets/vendor-DfjTe3v5.js","assets/Button-CC4DDPTB.js","assets/Button-A5E1YjHX.css","assets/Input-BxoBBgjz.js","assets/fullcalendar-DAzJmkx6.js","assets/ModalSettings-CJyMEECR.js","assets/ModalEvent-Dj1VwZLC.js","assets/ModalConfirm-BlSg_3AY.js","assets/ModalSetupPassword-DFBerh9g.js"])))=>i.map(i=>d[i]);
import{r as b,c as I,o as T,a as L,b as W,w as ke,e as B,F as ue,f as xe,u as P,n as ie,t as X,g as D,i as Ee,T as Oe,j as M,k as de,l as Ae,m as Le,p as Me,q as fe,s as Ie,v as F,x as De}from"./vendor-DfjTe3v5.js";import{i as Ne,a as Ue,b as Re,c as $e,d as Fe,F as je}from"./fullcalendar-DAzJmkx6.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&u(t)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();const Be=5,E=b([]);let Je=0;function H(){function e(c,d="info",i=null,m=5e3){if(!c)return;const _=++Je,g={id:_,message:c,type:d,title:i,visible:!0};for(E.value.push(g);E.value.length>Be;)E.value.shift();return m>0&&setTimeout(()=>{n(_)},m),_}function n(c){const d=E.value.findIndex(i=>i.id===c);d>-1&&E.value.splice(d,1)}function o(c,d=null,i=5e3){return e(c,"success",d,i)}function u(c,d=null,i=8e3){return e(c,"error",d,i)}function s(c,d=null,i=6e3){return e(c,"warning",d,i)}function a(c,d=null,i=5e3){return e(c,"info",d,i)}function t(){E.value.splice(0)}return{toasts:E,addToast:e,removeToast:n,success:o,error:u,warning:s,info:a,clear:t}}const Ve=(e,n)=>{const o=e.__vccOpts||e;for(const[u,s]of n)o[u]=s;return o},Ge={class:"toast-container fixed top-5 right-5 pointer-events-auto"},ze={class:"flex items-start gap-3"},qe={class:"flex-1 text-sm text-gray-800 dark:text-gray-200 leading-relaxed"},We={key:0,class:"font-bold mb-1 text-sm text-gray-800 dark:text-gray-100"},He=["onClick"],Qe={__name:"Toast",setup(e){const{toasts:n,removeToast:o}=H();function u(s){const a={success:"✓",error:"✕",warning:"⚠",info:"ℹ"};return a[s]||a.info}return(s,a)=>(T(),I(Oe,{to:"body"},[L("div",Ge,[W(Ee,{name:"toast",tag:"div"},{default:ke(()=>[(T(!0),B(ue,null,xe(P(n),t=>(T(),B("div",{key:t.id,class:ie(["bg-white border border-gray-300 rounded shadow-lg p-3 mb-3 min-w-[300px] max-w-[450px] pointer-events-auto relative font-inherit dark:bg-gray-800 dark:border-gray-600",t.type==="success"?"border-l-4 border-l-green-500":"",t.type==="error"?"border-l-4 border-l-red-500":"",t.type==="warning"?"border-l-4 border-l-yellow-500":"",t.type==="info"?"border-l-4 border-l-blue-500":""])},[L("div",ze,[L("div",{class:ie(["text-lg leading-none flex-shrink-0 mt-0.5",t.type==="success"?"text-green-500":"",t.type==="error"?"text-red-500":"",t.type==="warning"?"text-yellow-500":"",t.type==="info"?"text-blue-500":""])},X(u(t.type)),3),L("div",qe,[t.title?(T(),B("div",We,X(t.title),1)):D("",!0),L("div",null,X(t.message),1)])]),L("button",{class:"absolute top-1.5 right-2 bg-none border-none text-base text-gray-500 cursor-pointer p-1 w-6 h-6 flex items-center justify-center leading-none rounded hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700",onClick:c=>P(o)(t.id)}," × ",8,He)],2))),128))]),_:1})])]))}},Ke=Ve(Qe,[["__scopeId","data-v-b53fc0a3"]]),Xe="modulepreload",Ye=function(e){return"/"+e},le={},j=function(n,o,u){let s=Promise.resolve();if(o&&o.length>0){let d=function(i){return Promise.all(i.map(m=>Promise.resolve(m).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),c=t?.nonce||t?.getAttribute("nonce");s=d(o.map(i=>{if(i=Ye(i),i in le)return;le[i]=!0;const m=i.endsWith(".css"),_=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${_}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":Xe,m||(g.as="script"),g.crossOrigin="",g.href=i,c&&g.setAttribute("nonce",c),document.head.appendChild(g),m)return new Promise((S,p)=>{g.addEventListener("load",S),g.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${i}`)))})}))}function a(t){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=t,window.dispatchEvent(c),!c.defaultPrevented)throw t}return s.then(t=>{for(const c of t||[])c.status==="rejected"&&a(c.reason);return n().catch(a)})},Ze={},et=Ze?.VITE_API_BASE||"";function tt(e,n){const u=/^https?:\/\//i.test(e)?e:`${et}${e}`,s=new URL(u,window.location.origin);return n&&typeof n=="object"&&Object.entries(n).forEach(([a,t])=>{t!=null&&s.searchParams.set(a,String(t))}),s.toString()}async function w(e,n={}){const{method:o="GET",body:u,headers:s={},params:a,signal:t,timeoutMs:c=15e3,credentials:d="include"}=n,i=new AbortController,m=setTimeout(()=>i.abort(),c);t&&(t.aborted?i.abort():t.addEventListener("abort",()=>i.abort(),{once:!0}));const g=u!=null&&/^(POST|PUT|PATCH)$/i.test(o),S=tt(e,a),p=await fetch(S,{method:o,credentials:d,headers:{...g?{"Content-Type":"application/json"}:{},...s},body:g?u:void 0,signal:i.signal}).catch(v=>{throw clearTimeout(m),v});clearTimeout(m);const C=(p.headers.get("content-type")||"").includes("application/json"),O=p.status===204;let y;if(!O)try{y=C?await p.json():await p.text()}catch{y=null}const k=(v,x,R="",Q=null)=>({success:v,message:R,errors:Q,data:x,status:p.status});if(p.ok)return C&&y&&typeof y=="object"&&"success"in y?{...y,status:p.status}:k(!0,O?null:y??null);if(C&&y&&typeof y=="object"){const v=y.message||p.statusText,x=y.errors||null,R=y.data??null;return k(!1,R,v,x)}return k(!1,null,p.statusText||"Request failed",null)}const ee={auth:{async me(){return w("/api/auth/me")},async login(e){return w("/api/auth",{method:"POST",body:JSON.stringify({password:e})})},async logout(){return w("/api/auth/logout",{method:"POST"})},async setupPassword(e,n){return w("/api/auth/password",{method:"POST",body:JSON.stringify({password:e,confirmPassword:n})})},async changePassword(e,n,o){return w("/api/auth/password",{method:"PUT",body:JSON.stringify({currentPassword:e,newPassword:n,confirmPassword:o})})}},calendar:{async create(e){return w("/api/calendars",{method:"POST",body:JSON.stringify({name:e.name,url:e.url,color:e.color,visible_to_public:e.visible_to_public!==void 0?e.visible_to_public:!0,show_details_to_public:e.show_details_to_public!==void 0?e.show_details_to_public:!0})})},async update(e,n){return w(`/api/calendars/${e}`,{method:"PUT",body:JSON.stringify({name:n.name,url:n.url,color:n.color,visible_to_public:n.visible_to_public,show_details_to_public:n.show_details_to_public})})},async delete(e){return w(`/api/calendars/${e}`,{method:"DELETE"})},async import(e){return w("/api/calendars/import",{method:"POST",body:JSON.stringify({calendars:e})})},async export(){return w("/api/calendars/export")},async refresh(){return w("/api/calendars/refresh",{method:"POST"})}},settings:{async getCronSettings(){return w("/api/settings/cron")},async updateCronSettings(e,n){return w("/api/settings/cron",{method:"PUT",body:JSON.stringify({enabled:e,schedule:n})})},async updateTheme(e){return w("/api/settings/theme",{method:"PUT",body:JSON.stringify({theme:e})})},async regenerateFeedToken(){return w("/api/settings/feed-token/regenerate",{method:"POST"})},async updateFeedCalendars(e){return w("/api/settings/feed-token/calendars",{method:"PUT",body:JSON.stringify({calendars:e})})}}},Y=!1;function he(e=""){const n=e?`[${e}]`:"";return{log:(...o)=>Y,info:(...o)=>Y,warn:(...o)=>Y,error:(...o)=>console.error(n,...o)}}const te="calendar:cache",nt=1440*60*1e3,Z=he("AuthStore"),f=de({isAuthenticated:!1,isPasswordConfigured:null,cronSettings:null,theme:"system",feedToken:null,isSyncing:!1});function st(){try{const e=localStorage.getItem(te);if(!e)return null;const n=JSON.parse(e);return Date.now()-n._cachedAt>nt?(localStorage.removeItem(te),null):n}catch{return null}}function ot(e){try{const{feedToken:n,...o}=e;o._cachedAt=Date.now(),localStorage.setItem(te,JSON.stringify(o))}catch{}}function ce(e){f.isAuthenticated=!!e.isAuthenticated,f.isPasswordConfigured=!!e.isPasswordConfigured,f.cronSettings=e.cronSettings||null,f.theme=e.theme||"system",f.feedToken=e.feedToken||null}function me(){const e=H();async function n(){const t=st();return t?(ce(t),{calendars:t.calendars||[],fromCache:!0,sync:()=>o()}):{calendars:await o(),fromCache:!1}}async function o(){f.isSyncing=!0;try{const t=await ee.auth.me();return t?.success?(Z.log("Fresh data received:",Object.keys(t.data)),ce(t.data),ot(t.data),t.data.calendars||[]):(Z.error("Fetch failed - success:",t?.success,"status:",t?.status),[])}catch(t){return Z.error("Fetch error:",t.message),e.error("Failed to load app"),[]}finally{f.isSyncing=!1}}async function u(){try{const t=await ee.auth.logout();return t.success?(f.isAuthenticated=!1,f.isPasswordConfigured=null,f.cronSettings=null,f.theme="system",f.feedToken=null,e.success(t.message||"Logged out successfully"),!0):(e.error(t.message||"Failed to logout"),!1)}catch(t){return e.error("Logout error: "+t.message),!1}}function s(t){f.feedToken=t}function a(t){f.feedToken&&(f.feedToken.calendars=t)}return{isAuthenticated:M(f,"isAuthenticated"),isPasswordConfigured:M(f,"isPasswordConfigured"),cronSettings:M(f,"cronSettings"),theme:M(f,"theme"),feedToken:M(f,"feedToken"),isSyncing:M(f,"isSyncing"),initialize:n,logout:u,setPasswordConfigured:t=>f.isPasswordConfigured=t,setTheme:t=>f.theme=t,setFeedToken:s,setFeedCalendars:a}}let J=null,V=null;function rt(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function N(e){const n=document.documentElement;(e==="system"?rt():e)==="dark"?n.classList.add("dark"):n.classList.remove("dark")}function at(e){typeof window>"u"||(V=window.matchMedia("(prefers-color-scheme: dark)"),J=()=>{e.theme.value==="system"&&N("system")},V.addEventListener("change",J))}function it(){V&&J&&(V.removeEventListener("change",J),V=null,J=null)}function lt(){const e=me();function n(){N(e.theme.value),at(e),Le(()=>e.theme.value,u=>{N(u)})}async function o(u){const s=e.theme.value;e.setTheme(u),N(u);try{(await ee.settings.updateTheme(u)).success||(e.setTheme(s),N(s))}catch{e.setTheme(s),N(s)}}return Ae(()=>{it()}),{theme:e.theme,initialize:n,setTheme:o}}const ct={class:"h-screen w-screen"},ut={__name:"Calendar",setup(e){const n=F(()=>j(()=>import("./ModalPassword-D1oYOZNt.js"),__vite__mapDeps([0,1,2,3,4,5]))),o=F(()=>j(()=>import("./ModalSettings-CJyMEECR.js"),__vite__mapDeps([6,1,2,3,4,5]))),u=F(()=>j(()=>import("./ModalEvent-Dj1VwZLC.js"),__vite__mapDeps([7,2,1,3,5]))),s=F(()=>j(()=>import("./ModalConfirm-BlSg_3AY.js"),__vite__mapDeps([8,2,1,3,5]))),a=F(()=>j(()=>import("./ModalSetupPassword-DFBerh9g.js"),__vite__mapDeps([9,1,2,3,4,5]))),t=H(),c=he("Calendar"),d=me(),{initialize:i}=lt(),m=b([]),_=Me("calendarRef"),g=b([]),S=b(!1),p=b(!1),U=b(!1),C=b(!1),O=b(null),y=b(null),k=b("calendars"),v=de({show:!1,title:"",message:"",type:"default",confirmText:"Confirm",resolve:null,reject:()=>{v.show=!1,v.resolve=null,v.reject=null}}),x={month:"dayGridMonth",week:"timeGridWeek",day:"timeGridDay",list:"listMonth"};function R(){const r=new URLSearchParams(window.location.search);return x[r.get("view")]||"timeGridWeek"}function Q(){return new URLSearchParams(window.location.search).get("date")||void 0}const ge=b({plugins:[Ne,Ue,Re,$e,Fe],initialView:R(),initialDate:Q(),firstDay:1,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth settingsButton"},customButtons:{settingsButton:{text:"settings",hint:"Manage Calendars",click:pe}},height:"100%",nowIndicator:!0,expandRows:!0,editable:!1,selectable:!1,selectMirror:!1,businessHours:{daysOfWeek:[1,2,3,4,5],startTime:"09:00",endTime:"17:00"},eventSources:[],eventClick:we,eventSourceFailure:be,datesSet:se});async function pe(){d.isPasswordConfigured.value===!1?C.value=!0:(k.value=d.isAuthenticated.value?"calendars":"about",p.value=!0)}function ve(){S.value=!0}function ye(){C.value=!1,d.setPasswordConfigured(!0),S.value=!0}function we(r){if(r.jsEvent.preventDefault(),!d.isAuthenticated.value&&r.event.extendedProps&&!r.event.extendedProps.show_details_to_public)return;const l=g.value.find(h=>h.id==r.event.source.id);O.value=r.event,y.value=l,U.value=!0}function _e(){U.value=!1,O.value=null,y.value=null}function be(r){console.error("Calendar load failed:",r),t.error("Failed to load calendar events")}async function Te(){S.value=!1;const{calendars:r}=await d.initialize();m.value=r,G(r),p.value&&(k.value="calendars")}function G(r){const l=_.value?.getApi();if(l){l.removeAllEventSources(),g.value=[];for(const h of r)h?.id&&(l.addEventSource({id:h.id,events:h.events||[],color:h.color}),g.value.push({id:h.id,name:h.name,color:h.color}));l.render()}}async function ne(){try{const{calendars:r}=await d.initialize();m.value=r,G(r)}catch{t.error("Failed to load calendars")}}function se(){const r=_.value.getApi();if(!r)return;const l=r.view,h=r.getDate(),z=new Date().toISOString().split("T")[0],$=h.toISOString().split("T")[0],Ce=Object.keys(x).find(Pe=>x[Pe]===l.type)||"week",q=new URL(window.location);q.searchParams.set("view",Ce),$!==z?q.searchParams.set("date",$):q.searchParams.delete("date"),window.history.replaceState({},"",q.toString())}const K=b(new Date().toISOString().split("T")[0]),A=b(null);function Se(r){const l=_.value?.getApi();if(!l)return;!S.value&&!p.value&&!U.value&&!C.value&&!v.show&&l.getDate().toISOString().split("T")[0]===r&&(l.today(),se())}function oe(){const r=new Date().toISOString().split("T")[0];if(r===K.value)return;const l=K.value;K.value=r,Se(l),ae()}function re(){document.visibilityState==="visible"&&oe()}function ae(){A.value&&clearTimeout(A.value);const r=new Date,l=new Date(r);l.setDate(l.getDate()+1),l.setHours(0,0,0,100);const h=l-r;A.value=setTimeout(oe,h)}return fe(async()=>{const{calendars:r,fromCache:l,sync:h}=await d.initialize();if(c.log("Initialize done, fromCache:",l,"calendars:",r.length),m.value=r,G(r),i(),l&&h){const z=t.info("Syncing...",null,0),$=await h();m.value=$,G($),t.removeToast(z)}document.addEventListener("visibilitychange",re),ae()}),Ie(()=>{document.removeEventListener("visibilitychange",re),A.value&&(clearTimeout(A.value),A.value=null)}),(r,l)=>(T(),B("main",ct,[W(P(je),{ref_key:"calendarRef",ref:_,options:ge.value},null,8,["options"]),S.value?(T(),I(P(n),{key:0,onClose:l[0]||(l[0]=h=>S.value=!1),onAuthenticated:Te})):D("",!0),p.value?(T(),I(P(o),{key:1,onClose:l[1]||(l[1]=h=>p.value=!1),calendars:m.value,"initial-tab":k.value,"is-authenticated":P(d).isAuthenticated.value,onCalendarUpdated:ne,onShowPasswordModal:ve,onAuthChanged:ne},null,8,["calendars","initial-tab","is-authenticated"])):D("",!0),U.value?(T(),I(P(u),{key:2,event:O.value,calendar:y.value,onClose:_e},null,8,["event","calendar"])):D("",!0),v.show?(T(),I(P(s),{key:3,title:v.title,message:v.message,type:v.type,"confirm-text":v.confirmText,onConfirm:v.resolve,onCancel:v.reject},null,8,["title","message","type","confirm-text","onConfirm","onCancel"])):D("",!0),C.value?(T(),I(P(a),{key:4,onClose:l[2]||(l[2]=h=>C.value=!1),onPasswordConfigured:ye})):D("",!0)]))}},dt={__name:"App",setup(e){const n=H();return fe(()=>{const o=window.location.pathname;o!=="/"&&(n.error(`Page not found: ${o}`,"Not Found"),window.history.replaceState({},"","/"))}),(o,u)=>(T(),B(ue,null,[W(ut),W(Ke)],64))}},ft=De(dt);ft.mount("#app");export{Ve as _,ee as a,lt as b,me as c,H as u};
